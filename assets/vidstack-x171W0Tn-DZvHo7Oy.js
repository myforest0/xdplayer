import{c as f,s as k,T as n,p as v,e as p,a as m,i as T,b as $,d as r,f as S}from"./index-2yDd3r9W.js";import{E as P,t as g}from"./vidstack-a8Y1aEDS-FgnZ49Db.js";const c={Rj:-1,Ve:0,We:1,Ng:2,Og:3,Pg:5},d=class u extends P{constructor(){super(...arguments),this.$$PROVIDER_TYPE="YOUTUBE",this.scope=f(),this.O=k(""),this.nc=-1,this.oc=-1,this.Ga=0,this.Ha=new n(0,0),this.W=null,this.F=null,this.H=null,this.language="en",this.color="red",this.cookies=!1}get c(){return this.b.delegate.c}get currentSrc(){return this.W}get type(){return"youtube"}get videoId(){return this.O()}preconnect(){const t=[this.fb(),"https://www.google.com","https://i.ytimg.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net"];for(const e of t)v(e,"preconnect")}setup(t){this.b=t,super.setup(t),p(this.ld.bind(this)),p(this.md.bind(this)),this.c("provider-setup",this)}async play(){const{paused:t}=this.b.$state;if(m(t))return this.F||(this.F=g(()=>{if(this.F=null,t())return"Timed out."}),this.q("playVideo")),this.F.promise}async pause(){const{paused:t}=this.b.$state;if(!m(t))return this.H||(this.H=g(()=>{this.H=null,t()}),this.q("pauseVideo")),this.H.promise}setMuted(t){t?this.q("mute"):this.q("unMute")}setCurrentTime(t){this.q("seekTo",t)}setVolume(t){this.q("setVolume",t*100)}setPlaybackRate(t){this.q("setPlaybackRate",t)}async loadSource(t){var s;if(!T(t.src)){this.W=null,this.O.set("");return}const e=(s=t.src.match(u.kd))==null?void 0:s[1];this.O.set(e??""),this.W=t}fb(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}ld(){this.I();const t=this.O();if(!t){this.db.set("");return}this.db.set(`${this.fb()}/embed/${t}`)}md(){const t=this.O(),e=u.Xe;if(!t)return;if(e.has(t)){const a=e.get(t);this.c("poster-change",a);return}const s=new AbortController;return this.Qg(t,s),()=>{s.abort()}}async Qg(t,e){try{const s=["maxresdefault","sddefault","hqdefault"];for(const a of s)for(const o of[!0,!1]){const i=this.Rg(t,a,o);if((await fetch(i,{mode:"no-cors",signal:e.signal})).status<400){u.Xe.set(t,i),this.c("poster-change",i);return}}}catch{}this.c("poster-change","")}Rg(t,e,s){return`https://i.ytimg.com/${s?"vi_webp":"vi"}/${t}/${e}.${s?"webp":"jpg"}`}Ue(){const{keyDisabled:t}=this.b.$props,{$iosControls:e}=this.b,{controls:s,muted:a,playsinline:o}=this.b.$state,i=s()||e();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:i?1:void 0,color:this.color,controls:i?1:0,disablekb:!i||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:i?1:3,mute:a()?1:0,playsinline:o()?1:0}}q(t,e){this.hd({event:"command",func:t,args:e?[e]:void 0})}mc(){window.setTimeout(()=>this.hd({event:"listening"}),100)}nd(t){this.b.delegate.kc(void 0,t)}Ba(t){var e;(e=this.H)==null||e.resolve(),this.H=null,this.c("pause",void 0,t)}Fb(t,e){const{duration:s,currentTime:a}=this.b.$state,o=this.nc===c.Ve?s():t,i={currentTime:o,played:this.Ga>=o?this.Ha:this.Ha=new n(0,this.Ga=t)};this.c("time-update",i,e),Math.abs(o-a())>1&&this.c("seeking",o,e)}jc(t,e,s){const a={buffered:new n(0,t),seekable:e};this.c("progress",a,s);const{seeking:o,currentTime:i}=this.b.$state;o()&&t>i()&&this.cb(s)}cb(t){const{paused:e,currentTime:s}=this.b.$state;window.clearTimeout(this.oc),this.oc=window.setTimeout(()=>{this.c("seeked",s(),t),this.oc=-1},e()?100:0)}Eb(t){const{seeking:e}=this.b.$state;e()&&this.cb(t),this.c("end",void 0,t)}Sg(t,e){var i;const{paused:s}=this.b.$state,a=t===c.We,o=t===c.Og;switch(o&&this.c("waiting",void 0,e),s()&&(o||a)&&((i=this.F)==null||i.resolve(),this.F=null,this.c("play",void 0,e)),t){case c.Pg:this.nd(e);break;case c.We:this.c("playing",void 0,e);break;case c.Ng:this.Ba(e);break;case c.Ve:this.Eb(e);break}this.nc=t}jd({info:t},e){var i;if(!t)return;const{title:s,duration:a,playbackRate:o}=this.b.$state;if($(t.videoData)&&t.videoData.title!==s()&&this.c("title-change",t.videoData.title,e),r(t.duration)&&t.duration!==a()){if(r(t.videoLoadedFraction)){const h=((i=t.progressState)==null?void 0:i.loaded)??t.videoLoadedFraction*t.duration,l=new n(0,t.duration);this.jc(h,l,e)}this.c("duration-change",t.duration,e)}if(r(t.playbackRate)&&t.playbackRate!==o()&&this.c("rate-change",t.playbackRate,e),t.progressState){const{current:h,seekableStart:l,seekableEnd:y,loaded:w,duration:b}=t.progressState;this.Fb(h,e),this.jc(w,new n(l,y),e),b!==a()&&this.c("duration-change",b,e)}if(r(t.volume)&&S(t.muted)){const h={muted:t.muted,volume:t.volume/100};this.c("volume-change",h,e)}r(t.playerState)&&t.playerState!==this.nc&&this.Sg(t.playerState,e)}I(){this.nc=-1,this.oc=-1,this.Ga=0,this.Ha=new n(0,0),this.F=null,this.H=null}};d.kd=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/;d.Xe=new Map;let R=d;export{R as YouTubeProvider};
